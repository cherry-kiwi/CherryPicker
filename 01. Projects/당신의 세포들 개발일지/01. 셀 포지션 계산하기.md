# ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
### Raycastì™€ hitì„ ì´ìš©í•˜ì—¬ ë§ˆìš°ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ê²ƒ

**Raycast(Ray ray, out RaycastHit hitInfo, float maxDistance, int layerMask)**
- ray: ê´‘ì„ ì˜ ì‹œì‘ì ê³¼ ë°©í–¥
- hitInfo: true ë°˜í™˜ ì‹œ ê°€ì¥ ê°€ê¹Œìš´ ì¶©ëŒì²´ê°€ ì¶©ëŒí•œ ìœ„ì¹˜ì— ëŒ€í•œ ì •ë³´ í¬í•¨ë¨
- maxDistance: ì¶©ëŒì²´ í™•ì¸í•´ì•¼ í•˜ëŠ” ìµœëŒ€ ê±°ë¦¬
- layerMask: ê´‘ì„  ë°œì‚¬ ì‹œ ì¶©ëŒì²´ ë¬´ì‹œí•˜ê¸° ìœ„í•´ ì‚¬ìš©

- ì‚¬ìš© ë°©ë²•
```
using UnityEngine;

public class ExampleClass : MonoBehaviour
{
    void FixedUpdate()
    {
        Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);
        RaycastHit hit;

        if (Physics.Raycast(ray, out hit, 100))
            Debug.DrawLine(ray.origin, hit.point);
    }
}
```

- ğŸ“œ**InputManager**
```
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class InputManager : MonoBehaviour
{
    private Vector3 lastPosition; 

    [SerializeField]
    private LayerMask placementLayermask;

    public Vector3 GetSelectedMapPosition()
    {
        Vector3 mousePos = Input.mousePosition;
        mousePos.z = Camera.main.nearClipPlane; //nearClipPlane: ì¹´ë©”ë¼ì˜ ê¹Šì´
        Ray ray = Camera.main.ScreenPointToRay(mousePos);
        RaycastHit hit;

        if (Physics.Raycast(ray, out hit, 100, placementLayermask))
        {
            lastPosition = hit.point; //ê·¸ë¦¬ë“œë¡œ ì‚¬ìš©í•˜ë ¤ëŠ” í‰ë©´ë§Œ ê°ì§€
        }
        
        return lastPosition;
    }
}
```
- í•„ë“œ
	- lastPosition: ë§ˆìš°ìŠ¤ê°€ ê°ì§€ëœ ë§ˆì§€ë§‰ ìœ„ì¹˜ í¬ì°©í•˜ê¸° ìœ„í•œ ë³€ìˆ˜
	- placementLayermask: ì…ë ¥ì´ ê°ì§€ëœ ë ˆì´ì–´ ì €ì¥

- ë©”ì„œë“œ
	- GetSelectedMapPosition()
		- mousePos: ë§ˆìš°ìŠ¤ ì…ë ¥ê°’ì„ ë²¡í„° í˜•íƒœë¡œ ì €ì¥í•¨
		- mousePos.z ì— ì¹´ë©”ë¼ì˜ ê¹Šì´ ê°’ì„ ì €ì¥
		- ray: mousePos ìœ„ì¹˜ì— ìˆëŠ” ìŠ¤í¬ë¦° ì ì„ í†µí•´ ê´‘ì„ ìœ¼ë¡œ ë°˜í™˜í•˜ì—¬ ì €ì¥
		- hit: ê°ì²´ì™€ Rayì˜ ì¶©ëŒì— ëŒ€í•œ ê²°ê³¼ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” êµ¬ì¡°ì²´
		- 
		- ë§Œì•½ rayê°€ 100 ìœ ë‹› ê±°ë¦¬ ì•ˆì— ìˆëŠ” ë¬´ì–¸ê°€ì— ë¶€ë”ªí˜”ì„ ë•Œ,
			- lastPositionì— ê´‘ì„ ì´ ì½œë¼ì´ë”ì™€ ë¶€ë”ªíŒ ì›”ë“œ ìŠ¤í˜ì´ìŠ¤ì˜ ì§€ì ì„ ì €ì¥í•¨
		- lastPosition ë°˜í™˜

# ê·¸ë¦¬ë“œ
### ê·¸ë¦¬ë“œ ì»´í¬ë„ŒíŠ¸ì˜ CellToWorldì™€ WorldToCell êµ¬ì„± ìš”ì†Œë¥¼ ì´ìš©í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì‰½ê²Œ ë³€ê²½í•  ê²ƒ

- CellToWorld: ì…€ í¬ì§€ì…˜ì„ ì›”ë“œ í‘œì§€ì…˜ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
- WorldToCell: ì›”ë“œ í¬ì§€ì…˜ì„ ì…€ í¬ì§€ì…˜ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜

- ğŸ“œ**PlacementSystem**
```
public class PlacementSystem : MonoBehaviour
{
    [SerializeField]
    GameObject mouseIndicator, cellIndicator; 

    [SerializeField]
    private InputManager inputManager;
    
    [SerializeField]
    private Grid grid;

    private void Update()
    {
        Vector3 mousePosition = inputManager.GetSelectedMapPosition();
        Vector3Int gridPosition = grid.WorldToCell(mousePosition); //ë§ˆìš°ìŠ¤ ìœ„ì¹˜ë¥¼ ì…€ í‘œì§€ì…˜ìœ¼ë¡œ ë°”ê¿”ì¤Œ
        mouseIndicator.transform.position = mousePosition;
        cellIndicator.transform.position = grid.CellToWorld(gridPosition);
    }
}
```
- í•„ë“œ
	- mouseIndicator: ì»¤ì„œ
	- cellIndicator: ê·¸ë¦¬ë“œ ì¸ì§€í•˜ëŠ” ì‚¬ê°í˜• ëª¨ì–‘
	- grid: Grid ì»´í¬ë„ŒíŠ¸ ì €ì¥ìš© ë³€ìˆ˜

- ë©”ì„œë“œ
	- Update()
		- mousePosition: inputManager ìŠ¤í¬ë¦½íŠ¸ì˜ GetSelectedMapPosition() í•¨ìˆ˜ ê°€ì ¸ì™€ ì‹¤í–‰
		- gridPosition: mousePositionì„ ì…€ í¬ì§€ì…˜ìœ¼ë¡œ ë³€ê²½
		- mousePositionì— ì»¤ì„œ ìœ„ì¹˜ ì €ì¥
		- gridPositionì˜ ì…€ ìœ„ì¹˜ë¥¼ ì›”ë“œ í¬ì§€ì…˜ìœ¼ë¡œ ë³€ê²½í•œ ê°’ì„ cellIndicator ìœ„ì¹˜ì— ì €ì¥

cf)
- [[ì›”ë“œ í¬ì§€ì…˜ VS ë¡œì»¬ í¬ì§€ì…˜]]
- Vector3Int: ì •ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë²¡í„°ë¥¼ í‘œí˜„í•˜ëŠ” ê²ƒ

- Tags
	- #ray #raycast #raycastHit #hit #grid #CellToWorld #WorldToCell ...

- ì°¸ê³ 
	- https://kukuta.tistory.com/391 (Physics.Raycast ì™„ë²½ ê°€ì´ë“œ)
	- https://upbo.tistory.com/111 (Tilemapì˜ íƒ€ì¼ì— ë°ì´í„° ì €ì¥í•˜ê¸°)